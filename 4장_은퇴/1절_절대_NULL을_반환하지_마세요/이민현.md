# 4.1 절대 NULL을 반환하지 마세요

메서드의 인자에 NULL을 전달하는 것과 NULL을 반환하는 것은 잘못된 방법이다.

# NULL을 반환할 경우

- 메서드 내부에서 NULL을 반환한다면 해당 메서드를 신뢰할 수 없다.
- 해당 메서드를 호출할 경우, 호출하는 쪽에서 NPE가 일어날 것을 불안해 하고, 대비를 위해 확인을 해야한다. (객체에 대한 신뢰가 무너짐)

결국 유지보수성이 떨어진다.

(메서드의 호출을 하나하나 확인해야하며, 반환된 객체를 사용하기 전 NULL이 아닌지를 중복 체크해야함)

## 객체에 대한 신뢰란?

- 객체가 자신의 행동을 전적으로 책임진다.
- 우리가 어떤 식으로든 간섭하지 않는다.

```java
if(title == null) {
	print("Can't print; it's not a title.");
	return;
}
```

위의 예와 같이 예외를 던질 때에도 해당 객체 내에서 던져야지, 우리가 직접적으로 예외를 던지면 안된다.

**반환값을 검사하는 방식은 애플리케이션에 대한 신뢰가 부족하다는 명백한 신호이다.**

# 왜 NULL을 반환하는 메서드가 있을까?

NULL을 던지는 것보다는 예외를 던지는게 맞다. 하지만 왜 NULL을 던지는 메서드가 존재할까?

그것은 해당 설계자들이 설계하던 시점에 ‘빠르게 실패하기 원칙'을 몰랐기 때문이다.

# 4.1.1 빠르게 실패하기 vs. 안전하게 실패하기

## 안전하게 실패하기

- 버그, 입출력 문제, 오버플로우 등이 발생한 상황에서도 소프트웨어는 계속 실행되어야 한다.
- NULL을 반환하는 방법도 일종의 생존 기법
- 상황을 구조하기 위해 노력함 (IOException을 던지는 대신, 누군가 이상황을 처리할 수 있도록 NULL을 반환. NPE 발생이 되지 않을 것이란 희망을 갖고…)

## 빠르게 실패하기

- 문제 발생시 곧바로 실행을 중단하고 최대한 빨리 예외를 던짐.
- 모든 실패지점이 명확하고 훌륭하게 문서화 되어 있어 상황을 재생하는 테스트를 쉽게 추가 가능.
- 실패를 감추는 대신 강조함. (실패를 추적하기 쉽게 함)
- 상황을 구조하지 않고, 가능하면 실패를 분명하게 만든다.

**빠르게 실패하기를 통해 전체적인 품질이 향상된다.**

# 4.1.2 NULL의 대안

## 1. 메서드를 두개로 나누기

첫번째 메서드는 객체의 존재를 확인하고, 두번째 메서드는 객체를 반환.

아무것도 찾지 못한 경우 두번째 메서드는 예외를 던진다.

```java
public boolean exists(String name) {
	if (/* 데이터베이스에서 발견하지 못했다면 */) {
		return false;
	}
	return true;
}

public User user(String name) {
	return /* 데이터베이스로부터 */
}
```

- 데이터베이스에 요청을 두 번 전송하기 때문에 비효율적임.
    
    (DB에서 실제 존재하는지 확인 후, 값을 다시 조회해야하기 때문)
    

## 2. 객체 컬렉션 반환

위의 방식보다 좋은 방식이다.

```java
public Collection<User> users(String name) {
	if (/* 데이터베이스에서 발견하지 못했다면 */) {
		return new ArrayList<>(0);
	}

	return Collections.singleton(/* 데이터베이스로부터 */);
}
```

## 3. Optional 사용

java 내의 Optional을 사용하는 방식도 있다. 하지만 결국 하나의 봉투와 다르지 않다. **마치 NULL 참조와 매우 비슷하여 사용하지 말라.**

## 4. 널 객체 디자인 패턴

원하는 객체를 발견하지 못할 경우, 겉으로 보기엔 원 객체처럼 보이지만 실제론 다르게 행동하는 객체이다.

하지만 제한된 상황에서만 사용 가능하며, 반환된 객체의 타입을 동일하게 유지해야 한다는 단점이 있다.

```java
class NullUser implements User {
	private final String label;
	NullUser(String name) {
		this.label = name;
	}

	@Override
	public String name() {
		return this.label;
	}

	@Override
	public void raise(Cash salary) {
		throw new IllegalStateException(
			"제 봉급을 인상할 수 없습니다. 저는 스텁입니다.";
		)
	}
}
```

# 정리

절대로 NULL을 반환하지 말라.

**찾지 못한 뭔가를 반환할 필요가 있다면 예외를 던지거나, 컬렉션을 반환하거나, 널 객체를 반환하라.**

---

# 느낀점

역시나 NULL은 절대로 사용하면 안된다. 내가 무조건 지키는 규칙이다.

Optional을 사용하지 않는 이유가 특이했는데 본인은 사실 무겁기 때문에 자주 사용하지 않았다. 사실 내부에서 Optional 로 받아서 까뒤집고 반환하면 되지 않나? 생각했는데 여긴 그것도 자제하라는 식으로 얘기하는군.