불변객체는 상수와 동일한 개념이 아니다. **핵심은 객체가 살아있는 동안 상태가 변하지 않는다는 사실**이다.

# 대표자

디스크에 있는 파일, 웹 페이지, 바이트 배열, 해시맵 등과 같은 **실제 엔티티의 대표자**이다.

(실제라는 말은 객체의 가시성 범위 (scope of visibility) 밖에 존재하는 모든 것을 의미)

```java
public void echo() {
	File f = new File("/tmp/test.txt");
	System.out.println("File size: %d", file.length());
}
```

f의 가시성 범위는 `echo()`  메서드의 ‘경계'에 대응한다.

객체 f는 실제 파일의 입장을 대변한다. **우리의 관점에서 객체 f는 `echo()` 메서드 안에서 만큼은 파일이다.** 

# 상태

파일의 좌표를 객체의 상태라고 부른다.

**예를 들어 WebPage 객체의 상태는 페이지 URI이다.** 왜냐면 WebPage라는 객체는 HTTP 프로토콜을 이용해 웹 페이지를 읽어들일때 HTTP 엔드포인트의 좌표로 이 URI를 사용하기 때문이다.

따라서 **위의 예제에서 객체 f의 상태는 ‘/tmp/test.txt’ 이다.**

# 객체

모든 객체는 식별자(identity), 상태(state), 행동(behavior)을 포합한다.

- 식별자
    - f를 다른 객체와 구별
- 상태
    - f가 디스크 상의 파일에 대해 알고 있는 것
- 행동
    - 요청을 수신했을 때 f가 할 수 있는 작업

## **불변객체**

- 식별자가 존재하지 않음
- 절대로 상태를 변경할 수 없다.

상태가 동일한 중복된 인스턴스는 생성하지 않아야 한다. 이것을 구분하기 위해서 자바에서 equals & hashCode 를 사용한다.

WebPage 클래스 내의 캡슐화된 uri 프로퍼티에 기반하여 객체를 투명하게 만든다.

## 가변객체

- 독립적인 식별자를 별도로 포함해야 함.
- 상태가 변경 가능함

## 그래서

상태는 불변객체를 식별하기 위한 필요충분 조건이다.

불변 객체는 엔티티의 좌표를 절대로 변경하지 않으며, 어떤 경우에도 항상 동일한 엔티티를 대표한다.

# 상수리스트

객체가 대표하는 실제 엔티티와 객체의 상태가 동일한 경우에는 ‘불변' 대신 ‘상수' 라는 용어를 사용하라.

WebPage의 this.url은 실세계 엔티티인 웹 페이지의 좌표였지만 ConstantList에서는 대표하는 배열 엔티티가 바로 상태이다.

# 불변리스트

(ImmutableList 클래스 예시)

해당 객체 내의 필드들은 수정이 가능해 보이지만, 객체 자체를 수정하는 것이 아니기 때문에 불변이다.

# 정리

상수 객체가 설계, 유지보수, 이해하기 더 편하기 떄문에 불변객체보단 상수객체를 사용하는 편이 더 낫다.

결론적으로 **비즈니스 도메인과 기술 도메인 그리고 어떤 시스템에 무관하게 전체적으로 불변객체를 이용하여 설계될 수 있고 설계되어야 한다.**

---

# 느낀점

불변 리스트에서 보여준 예시가 불변이라는 것에 놀랬다.

사실 평소 final을 선언했음에도 불구하고 list나 hashmap이 수정이 가능하다는 것이 굉장히 의아했는데 이런 래핑한다는 접근법으로 가는거라면.. 이해가 조금 된다. 그런데……

unmodifiableList가 정말 불변인가? 조금 헷갈리는 부분이 있어서 [https://soft.plusblog.co.kr/71](https://soft.plusblog.co.kr/71) 의 개념을 보니 역시나 불변은 아니다. 해당 블로그글에선 ImmutableList 내의 items는 불변이 아니다. 를 얘기하는 거고 책에서는 ImmutableList 객체 자체가 변하는 것이 아니기 때문에 (items는 변하지만) 불변이다. 라고 얘기하고 있다.

어느 바운더리까지 포함하느냐의 차이인듯.

근데 이번 챕터는.. 잘 모르겠다…